#!/bin/bash

command="$1"
vpn=${2-work}
service="openvpn@$vpn.service"

case $command in
    up)
        sudo systemctl start "$service"
        while ! ip link show tun0 &> /dev/null; do
            sleep 1
            systemctl is-active "$service" >/dev/null || exit 1
        done
        resolvectl query google.com >/dev/null
        resolvectl status tun0
        ;;
    down)
        sudo systemctl stop "$service"
        while ip link show tun0 &> /dev/null; do sleep 1; done
        ;;
    --help)
        echo "vpn               Query VPN status"
        echo "vpn up [work]     Activate VPN"
        echo "vpn down [work]   Deactivate VPN"
        ;;
    *)
        resolvectl status tun0
        ;;
esac
